<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Cardano.Wallet.Network.BlockHeaders</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Cardano.Wallet.Network.BlockHeaders.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">cardano-wallet-core-2019.10.16: The Wallet Backend for a Cardano node.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>&#169; 2018-2019 IOHK</td></tr><tr><th>License</th><td>Apache-2.0</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Cardano.Wallet.Network.BlockHeaders</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Types</a></li><li><a href="#g:2">Managing the global unstable blocks state</a></li><li><a href="#g:3">Operations</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module provides a data structure and functions for operating on a
 sequence of block headers.</p><p>The <code><a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a></code> sequence is used for maintaining the global unstable
 blocks state for the network layer. The unstable blocks state can be compared
 with the block headers state of chain consumers to determine the intersection
 point.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">newtype</span> <a href="#t:BlockHeaders">BlockHeaders</a> = <a href="#v:BlockHeaders">BlockHeaders</a> {<ul class="subs"><li><a href="#v:getBlockHeaders">getBlockHeaders</a> :: <a href="../containers-0.6.0.1/Data-Sequence.html#t:Seq" title="Data.Sequence">Seq</a> <a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a></li></ul>}</li><li class="src short"><a href="#v:emptyBlockHeaders">emptyBlockHeaders</a> :: <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a></li><li class="src short"><a href="#v:updateUnstableBlocks">updateUnstableBlocks</a> :: <span class="keyword">forall</span> m. <a href="../base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m =&gt; <a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;block&quot; <a href="../base-4.12.0.0/Data-Word.html#t:Word32" title="Data.Word">Word32</a> -&gt; m (<a href="Cardano-Wallet-Primitive-Types.html#t:Hash" title="Cardano.Wallet.Primitive.Types">Hash</a> &quot;BlockHeader&quot;) -&gt; (<a href="Cardano-Wallet-Primitive-Types.html#t:Hash" title="Cardano.Wallet.Primitive.Types">Hash</a> &quot;BlockHeader&quot; -&gt; m <a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a>) -&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; m <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a></li><li class="src short"><a href="#v:blockHeadersTip">blockHeadersTip</a> :: <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="../base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> <a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a></li><li class="src short"><a href="#v:blockHeadersBase">blockHeadersBase</a> :: <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="../base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> <a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a></li><li class="src short"><a href="#v:blockHeadersAtGenesis">blockHeadersAtGenesis</a> :: <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li class="src short"><a href="#v:appendBlockHeaders">appendBlockHeaders</a> :: <a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;block&quot; <a href="../base-4.12.0.0/Data-Word.html#t:Word32" title="Data.Word">Word32</a> -&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; [<a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a>] -&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a></li><li class="src short"><a href="#v:dropStartingFromSlotId">dropStartingFromSlotId</a> :: <a href="Cardano-Wallet-Primitive-Types.html#t:SlotId" title="Cardano.Wallet.Primitive.Types">SlotId</a> -&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a></li><li class="src short"><a href="#v:dropAfterSlotId">dropAfterSlotId</a> :: <a href="Cardano-Wallet-Primitive-Types.html#t:SlotId" title="Cardano.Wallet.Primitive.Types">SlotId</a> -&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a></li><li class="src short"><a href="#v:greatestCommonBlockHeader">greatestCommonBlockHeader</a> :: <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="../base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> <a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a></li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Types</h1></a><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:BlockHeaders" class="def">BlockHeaders</a> <a href="src/Cardano.Wallet.Network.BlockHeaders.html#BlockHeaders" class="link">Source</a> <a href="#t:BlockHeaders" class="selflink">#</a></p><div class="doc"><p>A list of block headers and their hashes.
 The last block in this sequence is the network tip.
 The first block in this sequence is the block of depth <em>k</em>,
 which is the last unstable block.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:BlockHeaders" class="def">BlockHeaders</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:getBlockHeaders" class="def">getBlockHeaders</a> :: <a href="../containers-0.6.0.1/Data-Sequence.html#t:Seq" title="Data.Sequence">Seq</a> <a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a></dfn><div class="doc"><p>Double-ended queue of block headers, and their IDs.</p></div></li></ul></div></td></tr></table></div><div class="subs instances"><details id="i:BlockHeaders" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:BlockHeaders:Eq:1"></span> <a href="../base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a></span> <a href="src/Cardano.Wallet.Network.BlockHeaders.html#line-71" class="link">Source</a> <a href="#t:BlockHeaders" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:BlockHeaders:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Network-BlockHeaders.html">Cardano.Wallet.Network.BlockHeaders</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:BlockHeaders:Show:2"></span> <a href="../base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a></span> <a href="src/Cardano.Wallet.Network.BlockHeaders.html#line-71" class="link">Source</a> <a href="#t:BlockHeaders" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:BlockHeaders:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Network-BlockHeaders.html">Cardano.Wallet.Network.BlockHeaders</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="../base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="../base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a>] -&gt; <a href="../base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:BlockHeaders:Generic:3"></span> <a href="../base-4.12.0.0/GHC-Generics.html#t:Generic" title="GHC.Generics">Generic</a> <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a></span> <a href="src/Cardano.Wallet.Network.BlockHeaders.html#line-71" class="link">Source</a> <a href="#t:BlockHeaders" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:BlockHeaders:Generic:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Network-BlockHeaders.html">Cardano.Wallet.Network.BlockHeaders</a></p> <div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> :: <a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> -&gt; <a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <a href="#t:Rep" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:from">from</a> :: <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> x <a href="#v:from" class="selflink">#</a></p><p class="src"><a href="#v:to">to</a> :: <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> x -&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> <a href="#v:to" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:BlockHeaders:NFData:4"></span> <a href="../deepseq-1.4.4.0/Control-DeepSeq.html#t:NFData" title="Control.DeepSeq">NFData</a> <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a></span> <a href="src/Cardano.Wallet.Network.BlockHeaders.html#line-73" class="link">Source</a> <a href="#t:BlockHeaders" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:BlockHeaders:NFData:4"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Network-BlockHeaders.html">Cardano.Wallet.Network.BlockHeaders</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:rnf">rnf</a> :: <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; () <a href="#v:rnf" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:BlockHeaders:Rep:5"></span> <span class="keyword">type</span> <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a></span> <a href="src/Cardano.Wallet.Network.BlockHeaders.html#line-71" class="link">Source</a> <a href="#t:BlockHeaders" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:BlockHeaders:Rep:5"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Network-BlockHeaders.html">Cardano.Wallet.Network.BlockHeaders</a></p> <div class="src"><span class="keyword">type</span> <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> = <a href="../base-4.12.0.0/GHC-Generics.html#t:D1" title="GHC.Generics">D1</a> (<a href="../base-4.12.0.0/GHC-Generics.html#v:MetaData" title="GHC.Generics">MetaData</a> &quot;BlockHeaders&quot; &quot;Cardano.Wallet.Network.BlockHeaders&quot; &quot;cardano-wallet-core-2019.10.16-LUHRrJIIdKs74PBAQizTLw&quot; <a href="../base-4.12.0.0/Data-Bool.html#v:True" title="Data.Bool">True</a>) (<a href="../base-4.12.0.0/GHC-Generics.html#t:C1" title="GHC.Generics">C1</a> (<a href="../base-4.12.0.0/GHC-Generics.html#v:MetaCons" title="GHC.Generics">MetaCons</a> &quot;BlockHeaders&quot; <a href="../base-4.12.0.0/GHC-Generics.html#v:PrefixI" title="GHC.Generics">PrefixI</a> <a href="../base-4.12.0.0/Data-Bool.html#v:True" title="Data.Bool">True</a>) (<a href="../base-4.12.0.0/GHC-Generics.html#t:S1" title="GHC.Generics">S1</a> (<a href="../base-4.12.0.0/GHC-Generics.html#v:MetaSel" title="GHC.Generics">MetaSel</a> (<a href="../base-4.12.0.0/GHC-Maybe.html#v:Just" title="GHC.Maybe">Just</a> &quot;getBlockHeaders&quot;) <a href="../base-4.12.0.0/GHC-Generics.html#v:NoSourceUnpackedness" title="GHC.Generics">NoSourceUnpackedness</a> <a href="../base-4.12.0.0/GHC-Generics.html#v:NoSourceStrictness" title="GHC.Generics">NoSourceStrictness</a> <a href="../base-4.12.0.0/GHC-Generics.html#v:DecidedLazy" title="GHC.Generics">DecidedLazy</a>) (<a href="../base-4.12.0.0/GHC-Generics.html#t:Rec0" title="GHC.Generics">Rec0</a> (<a href="../containers-0.6.0.1/Data-Sequence.html#t:Seq" title="Data.Sequence">Seq</a> <a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a>))))</div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:emptyBlockHeaders" class="def">emptyBlockHeaders</a> :: <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> <a href="src/Cardano.Wallet.Network.BlockHeaders.html#emptyBlockHeaders" class="link">Source</a> <a href="#v:emptyBlockHeaders" class="selflink">#</a></p><div class="doc"><p>Constuct an empty unstable blocks sequence.</p></div></div><a href="#g:2" id="g:2"><h1>Managing the global unstable blocks state</h1></a><div class="top"><p class="src"><a id="v:updateUnstableBlocks" class="def">updateUnstableBlocks</a> <a href="src/Cardano.Wallet.Network.BlockHeaders.html#updateUnstableBlocks" class="link">Source</a> <a href="#v:updateUnstableBlocks" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;block&quot; <a href="../base-4.12.0.0/Data-Word.html#t:Word32" title="Data.Word">Word32</a></td><td class="doc"><p>Maximum number of unstable blocks (<em>k</em>).</p></td></tr><tr><td class="src">-&gt; m (<a href="Cardano-Wallet-Primitive-Types.html#t:Hash" title="Cardano.Wallet.Primitive.Types">Hash</a> &quot;BlockHeader&quot;)</td><td class="doc"><p>Network Tip</p></td></tr><tr><td class="src">-&gt; (<a href="Cardano-Wallet-Primitive-Types.html#t:Hash" title="Cardano.Wallet.Primitive.Types">Hash</a> &quot;BlockHeader&quot; -&gt; m <a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a>)</td><td class="doc"><p>Fetches block header from its hash</p></td></tr><tr><td class="src">-&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a></td><td class="doc"><p>Current unstable blocks state.</p></td></tr><tr><td class="src">-&gt; m <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Updates the unstable blocks state using the given &quot;fetch&quot; functions.</p><p>This attempts to synchronise the local state with that of the node. The node
 may be on a different chain to the current unstable blocks, so this function
 handles switching of chains.</p><p>For example, this is what it would do when the local tip is <code>a13</code>, but the
 node's tip is <code>b15</code>, on a different chain.</p><pre>                                   local tip &#8628;
                 &#9484;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;  &#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9488;
 Unstable blocks &#9474;a03&#9474;..    ..&#9474;a10&#9474;a11&#9474;a12&#9474;a13&#9474;
                 &#9492;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;  &#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9496;
                           &#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9488;
 Node backend chain        ...&#9474;a10&#9474;a11&#9474;b12&#9474;b13&#9474;b14&#9474;b15&#9474;
                           &#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9496;
                       rollback point &#11023;     node tip &#11023;
</pre><p>To start with, the node says the tip hash is <code>b15</code>.</p><p>Work backwards from tip, fetching blocks and adding them to <code>ac</code>, and
 removing overlapping blocks from <code>ubs</code>. Overlapping blocks occur when there
 has been a rollback.</p><pre>    ubs                     ac
1.  &#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9488;    &#9484;&#9472;&#9472;&#9472;&#9488;
    ...&#9474;a10&#9474;a11&#9474;a12&#9474;a13&#9474;    &#9474;b15&#9474;
    &#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9496;    &#9492;&#9472;&#9472;&#9472;&#9496;
2.  &#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9488;&#9484;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9488;
    ...&#9474;a10&#9474;a11&#9474;a12&#9474;a13&#9474;&#9474;b14&#9474;b15&#9474;
    &#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9496;&#9492;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9496;
3.  &#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9488;&#9484;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9488;
    ...&#9474;a10&#9474;a11&#9474;a12&#9474;&#9474;b13&#9474;b14&#9474;b15&#9474;
    &#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9496;&#9492;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9496;
4.  &#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9488;&#9484;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9488;
    ...&#9474;a10&#9474;a11&#9474;&#9474;b12&#9474;b13&#9474;b14&#9474;b15&#9474;
    &#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9496;&#9492;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9496;
</pre><p>Stop once <code>ubs</code> and <code>ac</code> meet with a block which has the same hash.
 If they never meet, stop cleanupConfig fetching <em>k</em> blocks.</p><p>Finally, to get the new <code><a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a></code>, append <code>ac</code> to <code>ubs</code>, and limit the
 length to <em>k</em>.</p><p>The new block height is the height of the first block that was fetched.</p><p>If any errors occur while this process is running (for example, fetching a
 block which has been rolled back and lost from the node's state), it will
 immediately terminate.</p></div></div><a href="#g:3" id="g:3"><h1>Operations</h1></a><div class="top"><p class="src"><a id="v:blockHeadersTip" class="def">blockHeadersTip</a> :: <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="../base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> <a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a> <a href="src/Cardano.Wallet.Network.BlockHeaders.html#blockHeadersTip" class="link">Source</a> <a href="#v:blockHeadersTip" class="selflink">#</a></p><div class="doc"><p>The tip block header of the unstable blocks, if it exists.</p></div></div><div class="top"><p class="src"><a id="v:blockHeadersBase" class="def">blockHeadersBase</a> :: <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="../base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> <a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a> <a href="src/Cardano.Wallet.Network.BlockHeaders.html#blockHeadersBase" class="link">Source</a> <a href="#v:blockHeadersBase" class="selflink">#</a></p><div class="doc"><p>The base block header is the oldest block header in the unstable blocks,</p></div></div><div class="top"><p class="src"><a id="v:blockHeadersAtGenesis" class="def">blockHeadersAtGenesis</a> :: <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="src/Cardano.Wallet.Network.BlockHeaders.html#blockHeadersAtGenesis" class="link">Source</a> <a href="#v:blockHeadersAtGenesis" class="selflink">#</a></p><div class="doc"><p>Whether we are at genesis or not.</p></div></div><div class="top"><p class="src"><a id="v:appendBlockHeaders" class="def">appendBlockHeaders</a> <a href="src/Cardano.Wallet.Network.BlockHeaders.html#appendBlockHeaders" class="link">Source</a> <a href="#v:appendBlockHeaders" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;block&quot; <a href="../base-4.12.0.0/Data-Word.html#t:Word32" title="Data.Word">Word32</a></td><td class="doc"><p>Maximum length of sequence.</p></td></tr><tr><td class="src">-&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a></td><td class="doc"><p>Current unstable block headers, with rolled back blocks removed.</p></td></tr><tr><td class="src">-&gt; [<a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a>]</td><td class="doc"><p>Newly fetched block headers to add.</p></td></tr><tr><td class="src">-&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Add recently fetched block headers to the unstable blocks. This will drop
 the oldest block headers to ensure that there are at most <em>k</em> items in the
 sequence.</p></div></div><div class="top"><p class="src"><a id="v:dropStartingFromSlotId" class="def">dropStartingFromSlotId</a> :: <a href="Cardano-Wallet-Primitive-Types.html#t:SlotId" title="Cardano.Wallet.Primitive.Types">SlotId</a> -&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> <a href="src/Cardano.Wallet.Network.BlockHeaders.html#dropStartingFromSlotId" class="link">Source</a> <a href="#v:dropStartingFromSlotId" class="selflink">#</a></p><div class="doc"><p>Remove unstable blocks which have a slot greater than or equal to the given
 slot.</p></div></div><div class="top"><p class="src"><a id="v:dropAfterSlotId" class="def">dropAfterSlotId</a> :: <a href="Cardano-Wallet-Primitive-Types.html#t:SlotId" title="Cardano.Wallet.Primitive.Types">SlotId</a> -&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> -&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a> <a href="src/Cardano.Wallet.Network.BlockHeaders.html#dropAfterSlotId" class="link">Source</a> <a href="#v:dropAfterSlotId" class="selflink">#</a></p><div class="doc"><p>Drop any headers that are (strictly) after the given slot id.</p></div></div><div class="top"><p class="src"><a id="v:greatestCommonBlockHeader" class="def">greatestCommonBlockHeader</a> <a href="src/Cardano.Wallet.Network.BlockHeaders.html#greatestCommonBlockHeader" class="link">Source</a> <a href="#v:greatestCommonBlockHeader" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a></td><td class="doc"><p>Node's unstable blocks</p></td></tr><tr><td class="src">-&gt; <a href="Cardano-Wallet-Network-BlockHeaders.html#t:BlockHeaders" title="Cardano.Wallet.Network.BlockHeaders">BlockHeaders</a></td><td class="doc"><p>Local wallet unstable blocks</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.12.0.0/GHC-Maybe.html#t:Maybe" title="GHC.Maybe">Maybe</a> <a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>If the two sequences overlap in terms of slots, return the block header of
 the last block that is common between the two. Otherwise return Nothing.</p><p><code><a href="Cardano-Wallet-Network-BlockHeaders.html#v:greatestCommonBlockHeader" title="Cardano.Wallet.Network.BlockHeaders">greatestCommonBlockHeader</a></code> works fine if one (or both) list are sparse and
 different length.</p><p>For example:
 <code>
        | (1)         | (2)         | (3)         | (4)         | (5)
 Node   | abcdefg     |     efg     | abcdefg     | abcde       | abc
 Local  |   cdpqrst   | abc         | abcdefg     |             |     efg
 GCBH   | Just d      | Nothing     | Just g      | Nothing     | Nothing
 </code></p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>