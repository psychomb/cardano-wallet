-- Hoogle documentation, generated by Haddock
-- See Hoogle, http://www.haskell.org/hoogle/


-- | Utilities for a building commands launcher
--   
--   Utilities for a building commands launcher
@package cardano-wallet-launcher
@version 2019.11.7


-- | This module contains a mechanism for launching external processes,
--   ensuring that they are terminated on exceptions.
module Cardano.Launcher

-- | Represent a command to execute. Args are provided as a list where
--   options are expected to be prefixed with `--` or <a>-</a>. For
--   example:
--   
--   <pre>
--   Command "cardano-wallet"
--       [ "server"
--       , "--port", "8080"
--       , "--network", "mainnet"
--       ] (return ())
--       Inherit
--   </pre>
data Command
Command :: String -> [String] -> IO () -> StdStream -> Command
[cmdName] :: Command -> String
[cmdArgs] :: Command -> [String]

-- | An extra action to run _before_ the command
[cmdSetup] :: Command -> IO ()

-- | What to do with stdout &amp; stderr
[cmdOutput] :: Command -> StdStream
data StdStream

-- | Inherit Handle from parent
Inherit :: StdStream

-- | Use the supplied Handle
UseHandle :: Handle -> StdStream

-- | Create a new pipe. The returned <tt>Handle</tt> will use the default
--   encoding and newline translation mode (just like <tt>Handle</tt>s
--   created by <tt>openFile</tt>).
CreatePipe :: StdStream

-- | Close the stream's file descriptor without passing a Handle. On POSIX
--   systems this may lead to strange behavior in the child process because
--   attempting to read or write after the file has been closed throws an
--   error. This should only be used with child processes that don't use
--   the file descriptor at all. If you wish to ignore the child process's
--   output you should either create a pipe and drain it manually or pass a
--   <tt>Handle</tt> that writes to <tt>/dev/null</tt>.
NoStream :: StdStream

-- | ProcessHasExited is used by a monitoring thread to signal that the
--   process has exited.
data ProcessHasExited
ProcessDidNotStart :: String -> IOException -> ProcessHasExited
ProcessHasExited :: String -> ExitCode -> ProcessHasExited

-- | Run a bunch of command in separate processes. Note that, this
--   operation is blocking and will throw when one of the given commands
--   terminates. Commands are therefore expected to be daemon or
--   long-running services.
launch :: Trace IO LauncherLog -> [Command] -> IO ProcessHasExited

-- | Starts a command in the background and then runs an action. If the
--   action finishes (through an exception or otherwise) then the process
--   is terminated (see <a>withCreateProcess</a>) for details. If the
--   process exits, the action is cancelled. The return type reflects those
--   two cases.
withBackendProcess :: Trace IO LauncherLog -> Command -> IO a -> IO (Either ProcessHasExited a)

-- | Convert any SIGTERM received to SIGINT, for which the runtime system
--   has handlers that will correctly clean up sub-processes.
installSignalHandlers :: Trace IO Text -> IO ()

-- | Force the locale text encoding to UTF-8. This is needed because the
--   CLI prints UTF-8 characters regardless of the <tt>LANG</tt>
--   environment variable or any other settings.
--   
--   On Windows the current console code page is changed to UTF-8.
withUtf8Encoding :: IO a -> IO a
data LauncherLog
MsgLauncherStart :: Command -> LauncherLog
MsgLauncherStarted :: String -> Text -> LauncherLog
MsgLauncherFinish :: ProcessHasExited -> LauncherLog
MsgLauncherCleanup :: LauncherLog
transformLauncherTrace :: Trace IO Text -> Trace IO LauncherLog
instance Data.Aeson.Types.ToJSON.ToJSON Cardano.Launcher.LauncherLog
instance GHC.Generics.Generic Cardano.Launcher.LauncherLog
instance GHC.Classes.Eq Cardano.Launcher.ProcessHasExited
instance GHC.Show.Show Cardano.Launcher.ProcessHasExited
instance GHC.Generics.Generic Cardano.Launcher.Command
instance GHC.Exception.Type.Exception Cardano.Launcher.ProcessHasExited
instance Data.Aeson.Types.ToJSON.ToJSON Cardano.Launcher.ProcessHasExited
instance Formatting.Buildable.Buildable Cardano.Launcher.Command
instance Data.Aeson.Types.ToJSON.ToJSON Cardano.Launcher.Command
